---
import { themeConfig } from '@/config'
import { getLangFromPath } from '@/i18n/lang'
import { getLocalizedPath } from '@/i18n/path'

const { author } = themeConfig.site
const { links, legals, startYear } = themeConfig.footer
const { highlight } = themeConfig.color.light

const currentYear = new Date().getFullYear()
const year = Number(startYear) === currentYear
  ? startYear
  : `${startYear}-${currentYear}`

const currentLang = getLangFromPath(Astro.url.pathname)
const socialLinks = links.map(({ name, url }) => {
  const isRSS = url === '/atom.xml' || url === '/rss.xml'
  const isEmail = /^[\w.-]+@[\w.-]+\.[a-z]{2,}$/i.test(url)

  if (isRSS) {
    const localizedPath = getLocalizedPath(url, currentLang)
    const href = import.meta.env.DEV
      ? localizedPath
      : localizedPath.slice(0, -1)

    return {
      name,
      href,
      target: '_blank',
      rel: 'noopener noreferrer',
    }
  }

  if (isEmail) {
    const href = `mailto:${url}`
    return {
      name,
      href,
      'data-umami-event': 'outbound-link-click',
      'data-umami-event-url': href,
    }
  }

  return {
    name,
    'href': url,
    'target': '_blank',
    'rel': 'noopener noreferrer',
    'data-umami-event': 'outbound-link-click',
    'data-umami-event-url': url,
  }
})

const legalLinks = legals.map(({ name, url }) => {
  const isInternalPath = url.startsWith('/')

  if (isInternalPath) {
    const localizedPath = getLocalizedPath(url, currentLang)
    return {
      name,
      href: localizedPath,
    }
  }

  return {
    name,
    'href': url,
    'target': '_blank',
    'rel': 'noopener noreferrer',
    'data-umami-event': 'outbound-link-click',
    'data-umami-event-url': url,
  }
})
---

<footer
  class="text-3 leading-1.25em font-navbar"
  lg="uno-desktop-column bottom-20 text-3.5"
>
  <p>
    {socialLinks.map((link, index) => (
      <>
        <a class="highlight-hover py-0.8 transition-colors after:bottom-0.35em hover:c-primary" style={`--highlight-color: ${highlight}`} {...link}>{link.name}</a>
        {index < socialLinks.length - 1 && '/'}
      </>
    ))}
  </p>

  <p>
    Â© {year} {author}
  </p>

  <p>
  {legalLinks.map((link, index) => (
    <>
      <a class="highlight-hover py-0.8 text-2.5 transition-colors after:bottom-0.5em hover:c-primary" style={`--highlight-color: ${highlight}`} {...link}>{link.name}</a>
      {index < legalLinks.length - 1 && '/'}
    </>
  ))}
  </p>
</footer>
